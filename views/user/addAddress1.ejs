<%-include('header')-%>

<!--Body Content-->
<div id="page-content">
    <!--Page Title-->
    <div class="page section-header text-center">
        <div class="page-title">
            <div class="wrapper"><h1 class="page-width">BILLING DETAILS</h1></div>
          </div>
    </div>
    <!--End Page Title-->

    <div class="container">
        <div class="row">
           
            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 sm-margin-30px-bottom">
                <div class="create-ac-content bg-light-gray padding-20px-all">

                    <div id="your-address" class="coupon-checkout-content">
                        <div class="discount-coupon">
                            <h2 class="login-title mb-3">Billing Address</h2>
                    
                            <% billingDetails.forEach((billingDetail, index) => { %>
                                <div class="row">
                                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                        <span>First Name:</span>
                                        <span><%= billingDetail.name %></span>
                                    </div>
                    
                                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                        <span>Telephone:</span>
                                        <span><%= billingDetail.telephone %></span>
                                    </div>
                                </div>
                    
                                <div class="row">
                                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                        <span>Address:</span>
                                        <span><%= billingDetail.address %></span>
                                    </div>
                                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                        <span>City:</span>
                                        <span><%= billingDetail.city %></span>
                                    </div>
                                </div>
                    
                                <div class="row">
                                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                        <span>Post Code:</span>
                                        <span><%= billingDetail.postCode %></span>
                                    </div>
                                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                        <span>Region / State:</span>
                                        <span><%= billingDetail.regionState %></span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                        <span>select</span>
                                        <!-- <input type="radio" name="address-selection" value="address1" data-user-id="<%=userId %>"  data-address-id="<%= billingDetail._id %>"> -->
                                    </div>
                                    <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                        <a href="" class="btn btn--secondary billingAddress__remove" title="Remove tem" data-user-id="<%=userId %>"  data-address-id="<%= billingDetail._id %>"><i class="icon icon anm anm-times-l"></i></a>

                                    </div>
                                </div>
                                <hr>
                            <% }); %>
                        </div>
                    </div>

                    <div class="customer-box customer-coupon">
                        <h3 class="font-15 xs-font-13"><i class=""></i>  <a href="#add-address" class="text-white text-decoration-underline" data-toggle="collapse">Add Address</a></h3>
                    </div>  

                    <div id="add-address" class="collapse coupon-checkout-content">
                        <div class="discount-coupon">
                            <form  id="address-form" action="/address-added" method="POST">
                                    <h2 class="login-title mb-3">Billing details</h2>
                                    <div class="row">
                                        <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                            <label for="input-name">First Name <span class="required-f">*</span></label>
                                            <input name="name"  id="input-name" type="text">
                                            <div class="error" style="color: red;"></div>
                                        </div>

                                        <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                            <label for="input-telephone">Telephone <span class="required-f">*</span></label>
                                            <input name="telephone"  id="input-telephone" type="tel">
                                            <div class="error" style="color: red;"></div>
                                        </div>


                                    </div>
                                    
        
                                    <div class="row">
                                        <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                            <label for="input-homeAddress">Address <span class="required-f">*</span></label>
                                            <input name="homeAddress"  id="input-homeAddress" type="text">
                                            <div class="error" style="color: red;"></div>
                                        </div>

                                        <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                            <label for="input-city">City <span class="required-f">*</span></label>
                                            <input name="city"  id="input-city" type="text">
                                            <div class="error" style="color: red;"></div>
                                        </div>

                                    </div>
                                   
                                    <div class="row">
                                        <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                            <label for="input-postcode">Post Code <span class="required-f">*</span></label>
                                            <input name="postcode"  id="input-postcode" type="text">
                                            <div class="error" style="color: red;"></div>
                                        </div>

                                        <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                            <label for="input-zone">Region / State <span class="required-f">*</span></label>
                                            <input name="state"  id="input-state" type="text">
                                            <div class="error" style="color: red;"></div>
                                        </div>
                                        <div class="form-group col-md-6 col-lg-6 col-xl-6 required">
                                            <button class="btn" style="background-color: cadetblue;" type="submit">Submit</button>
                                        </div>
                                    </div>
                            </form> 
                        </div>
                    </div>

                </div>
            </div>

            



        
        </div>
    </div>
</div>
<!--End Body Content-->

<!-- Include SweetAlert library -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const removeButtons = document.querySelectorAll('.billingAddress__remove');
    removeButtons.forEach(button => {
      button.addEventListener('click', function (event) {
        event.preventDefault();
        const addressId = button.dataset.addressId;
        const userId = button.dataset.userId;

        // Display confirmation dialog using SweetAlert
        Swal.fire({
          title: 'Are you sure?',
          text: 'You are about to remove this billing address.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Yes, remove it!'
        }).then((result) => {
          if (result.isConfirmed) {
            // Proceed with removal
            fetch(`/${userId}/remove/${addressId}`, {
              method: 'GET',
              headers: {
                'Content-Type': 'application/json',
              },
            })
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              // Display success message using SweetAlert
              Swal.fire({
                title: 'Success!',
                text: 'Billing address removed successfully.',
                icon: 'success',
              }).then(() => {
                // Reload the page
                window.location.reload();
              });
            })
            .catch(error => {
              console.error('Error removing billing address:', error);
              // Display error message using SweetAlert
              Swal.fire({
                title: 'Error!',
                text: 'Failed to remove billing address. Please  try again once later.',
                icon: 'error',
              });
            });
          }
        });
      });
    });
  });
</script>


<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
      const removeButtons = document.querySelectorAll('.billingAddress__remove');
      removeButtons.forEach(button => {
        button.addEventListener('click', function (event) {
          event.preventDefault();
          const addressId = button.dataset.addressId;
          const userId = button.dataset.userId

          console.log(addressId);//its get
          console.log(userId);
          console.log(999);

          fetch(`/${userId}/remove/${addressId}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                },
          })
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            window.location.reload();
          })
          .catch(error => {
            console.error('Error removing product:', error);
          });
        });
      });
    });
  </script> -->
 




     <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById("address-form");
    
            form.addEventListener('submit', async function (event) {
                event.preventDefault();
    
                let valid = validateForm();
    
                if (valid) {
                    const formData = new FormData(form);
                    const formObject = {};
                    formData.forEach((value, key) => {
                        formObject[key] = value;
                    });

                    

                    // Now, formObject contains the form values
                    console.log(formObject);
                    try {
                        const response = await fetch("/address-added", {
                            method: "POST",
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ formObject  }),
                        });


                        
    
                        if (response.ok) {
                            console.log("Form submitted successfully!");

                            // window.location.href = '/checkout';
                             window.location.reload();


                        } else {
                            console.error("Form submission failed:", response.statusText);
                        }
                    } catch (error) {
                        console.error("Error during form submission:", error);
                    }
                }
            });
    
            function validateForm() {
                let valid = true;
    
                // Reset previous error messages
                const errorMessages = form.querySelectorAll('.error');
                errorMessages.forEach(function (error) {
                    error.textContent = '';
                });
    
                // Validate User Name
                const name = form.querySelector('#input-name').value.trim();
                if (name === '') {
                    valid = false;
                    displayError('input-name', 'User Name is required.');
                }
    
                const telephone = form.querySelector("#input-telephone").value.trim();
                if (telephone === '' || isNaN(telephone) || telephone.length !== 10) {
                    valid = false;
                    displayError('input-telephone', 'Enter a valid 10-digit number.');
                }
    
                const postcode = form.querySelector("#input-postcode").value.trim();
                if (postcode === '' || isNaN(postcode) || postcode.length !== 6) {
                    valid = false;
                    displayError('input-postcode', 'Enter a valid postcode.');
                }
    
                const cityName = form.querySelector('#input-city').value.trim();
                if (cityName === '') {
                    valid = false;
                    displayError('input-city', 'City is required.');
                }
    
                const address = form.querySelector("#input-homeAddress").value.trim();
                if (address === '') {
                    valid = false;
                    displayError('input-homeAddress', 'Address is required.');
                }
    
                const state = form.querySelector("#input-state").value.trim();
                if (state === '') {
                    valid = false;
                    displayError('input-state', 'State is required.');
                }
    
                return valid;
            }
    
            function displayError(elementId, errorMessage) {
                const errorElement = form.querySelector(`#${elementId} + .error`);
                if (errorElement) {
                    errorElement.textContent = errorMessage;
                }
            }
        });
    </script>


<%-include('footer')-%>


    
</body>
</html>