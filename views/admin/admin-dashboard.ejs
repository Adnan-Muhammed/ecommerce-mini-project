
<%-include('header')-%>



            <!-- Sale & Revenue Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="row g-4">
                    <div class="col-sm-6 col-xl-3">
                        <div class="bg-light rounded d-flex align-items-center justify-content-between p-4">
                            <i class="fa fa-chart-line fa-3x text-primary"></i>
                            <div class="ms-3">
                                <p class="mb-2">Total Sales Count </p>
                                <%if(locals.totalOrder){%>
                                    <h6 class="mb-0"><%=totalOrder%></h6>
                                <%}else{%>
                                    <h6 class="mb-0">No Sales</h6>
                                <%}%>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="bg-light rounded d-flex align-items-center justify-content-between p-4">
                            <i class="fa fa-chart-bar fa-3x text-primary"></i>
                            <div class="ms-3">
                                <p class="mb-2">Total Sales Amount</p>
                                <%if(locals.totalAmount){%>
                                    <h6 class="mb-0">₹<%=totalAmount%></h6>
                                <%}else{%>
                                    <h6 class="mb-0">No Sales</h6>
                                <%}%>                            
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="bg-light rounded d-flex align-items-center justify-content-between p-4">
                            <i class="fa fa-chart-area fa-3x text-primary"></i>
                            <div class="ms-3">
                                <p class="mb-2">Overall discount</p>
                                <%if(locals.totalDiscount){%>
                                    <h6 class="mb-0">₹<%=totalDiscount%></h6>
                                <%}else{%>
                                    <h6 class="mb-0">No Discounts</h6>
                                <%}%>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="bg-light rounded d-flex align-items-center justify-content-between p-4">
                            <i class="fa fa-chart-pie fa-3x text-primary"></i>
                            <div class="ms-3">
                                <p class="mb-2">Coupon deduction</p>
                                <%if(locals.couponDiscount){%>
                                    <h6 class="mb-0">₹<%=couponDiscount%></h6>
                                <%}else{%>
                                    <h6 class="mb-0">No CouponDeduction</h6>
                                <%}%>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
            <!-- Sale & Revenue End -->


            <!-- Sales Chart Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="row g-4">
                        

                        <div class="col-sm-12 col-xl-6">
                            <div class="bg-light rounded h-100 p-4">
                                <h6 class="mb-4">Single Bar Chart</h6>
                                <canvas id="bar-chart"></canvas>
                            </div>
                        </div>

                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-light text-center rounded p-4">
                            <div class="d-flex align-items-center justify-content-between mb-4">
                                <h6 class="mb-0">Salse & Revenue</h6>
                                <a href="">Show All</a>
                            </div>
                            <canvas id="salse-revenue"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Sales Chart End -->
            <br>




            <!-- Recent Sales Start -->



            <!-- <div class="bg-light rounded h-100 p-4"> -->
                <h6 class="mb-4">Sales Report</h6>
                
                <div class="table-responsive">
                    <table id="salesTable" class="table table-bordered">
                        <thead>
                            <tr class="text-dark">
                                <th rowspan="2"></th> <!-- Add a column for checkbox input -->
                                <th rowspan="2">User Name</th>
                                <th rowspan="2">Order Date</th>
                                <th rowspan="2">Grand Total</th>
                                <th rowspan="2">Payment Status &<br>Order Status</th>
                                <th rowspan="2">Coupon</th>
                                <th rowspan="2">Tax</th>
                                <th style="text-align: center;" colspan="7">Order Items</th>
                                <th rowspan="2">Action</th>
                            </tr>
                            <tr class="text-dark">
                                <!-- Other headers -->
                                <th>Product Name</th>
                                <th>Unit Price</th>
                                <th>Quantity</th>
                                <th>Product Price</th>
                                <th>Category Offer</th>
                                <th>Product Offer</th>
                                <th>Total Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Iterate over orders and order items -->
                            <% orders.forEach(order => { %>
                                <% order.orderItems.forEach((item, index) => { %>
                                    <tr class="text-dark">
                                        <!-- Checkbox input for each row -->
                                        <!-- Render order details -->
                                        <% if (index === 0) { %>
                                            <td rowspan="<%= order.orderItems.length %>"><input type="checkbox"></td>
                                            <td rowspan="<%= order.orderItems.length %>"><%= order.userName %></td>
                                            <td rowspan="<%= order.orderItems.length %>"><%= new Date(order.orderDate).toLocaleString('en-US', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true }) %></td>
                                            <td rowspan="<%= order.orderItems.length %>"><%= order.grandTotal %></td>
                                            <td rowspan="<%= order.orderItems.length %>">
                                                <%= order.paymentStatus.type %>
                                                <br>
                                                <%= order.orderStatus.type %>
                                            </td>
                                            <td rowspan="<%= order.orderItems.length %>">
                                                <% if(order.couponName){ %>
                                                    <%= order.couponName %>
                                                    <br>
                                                    <%= order.couponDiscountPercentage %> %
                                                    <br>
                                                    <%= order.couponDiscount %>
                                                <% }else{ %>
                                                    N/A
                                                <% } %>
                                            </td>
                                            <td rowspan="<%= order.orderItems.length %>"><%= order.tax %></td>
                                        <% } %>
                                        <!-- Render order item details -->
                                        <td><%= item.productName %></td>
                                        <td><%= item.unitPrice %></td>
                                        <td><%= item.quantity %></td>
                                        <td><%= item.price %></td>
                                        <td>
                                            <%= item.categoryDiscountPecentage %>%
                                            <br>
                                            <%= item.categoryOffer %>
                                        </td>
                                        <td>
                                            <%= item.productDiscountPercentage %>%
                                            <br>
                                            <%= item.productOffer %>
                                        </td>
                                        <td><%= item.totalPrice %></td>
                                        <!-- Render action -->
                                        <% if (index === 0) { %>
                                            <td rowspan="<%= order.orderItems.length %>"><a class="btn btn-sm btn-primary" href="">Download</a></td>
                                        <% } %>
                                    </tr>
                                <% }); %>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <!-- </div> -->



















        </div>
        <!-- Content End -->



<script>
    // Function to handle the click event of the "Download PDF" button
    function downloadPDF() {
        // Fetch data from the table
        const tableRows = document.querySelectorAll('.table tbody tr');
        const data = [];

        // Iterate over table rows to collect data
        tableRows.forEach(row => {
            const columns = row.querySelectorAll('td');
            const rowData = {
                orderDate: columns[0].innerText.trim(),
                invoice: columns[1].innerText.trim(),
                customer: columns[2].innerText.trim(),
                amount: columns[3].innerText.trim(),
                status: columns[4].innerText.trim()
            };
            data.push(rowData);
        });

        // Send data to the server via Fetch API
        fetch('/admin/download-pdf', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            // Handle response
            if (response.ok) {
                // PDF downloaded successfully
                console.log('PDF downloaded successfully');
            } else {
                // Error handling
                console.error('Error downloading PDF:', response.status);
            }
        })
        .catch(error => {
            console.error('Error downloading PDF:', error);
        });
    }
</script>


        <!-- Back to Top -->

        <%-include('footer')-%>


      